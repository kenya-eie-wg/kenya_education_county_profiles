"0",""
"0","locations <- read_xlsx(""./data/ken_adminboundaries_tabulardata.xlsx"", "
"0","                      sheet = ""ADM1"") %>% "
"0","  clean_names()"
"0",""
"0","pcode1_shape <- "
"0","  sf::st_read(""./data/ken_adm_iebc_20191031_shp/ken_admbnda_adm1_iebc_20191031.shp"", "
"0","          quiet = TRUE) %>% "
"0","  clean_names() "
"0",""
"0","asal_county_list <- read_csv(""./data/counties.csv"") %>%  "
"0","  mutate(county = recode(county, "
"0","                         ""national"" = ""National"","
"0","                         ""Tharaka Nithi"" = ""Tharaka-Nithi"")) %>% "
"0","  distinct(county) %>% pull()"
"0",""
"0","counties <- read_csv(""./data/counties.csv"") %>% "
"0","  mutate(sex_modifier = fct_relevel(sex_modifier, c(""male"", ""female"", ""total""))) %>% "
"0","  # Important -- the old values were wrong"
"0","  rbind(read_csv(""./data/learner_toilet_ratio_recalculated.csv"") %>%"
"0","          filter(county %in% c(asal_county_list)) %>% "
"0","          mutate(indicator = ""learner_toilet_ratio_recalculated"") %>%"
"0","          select(indicator, county, age_modifier, sex_modifier, value = learner_toilet_ratio)) %>% "
"0","  mutate(age_modifier = ifelse(age_modifier == ""preprimary"", "
"0","                               ""preprimary_ece"", "
"0","                               age_modifier), "
"0","         county = recode(county, "
"0","                         ""national"" = ""National"","
"0","                         ""Tharaka Nithi"" = ""Tharaka-Nithi""))"
"0",""
"0",""
"0","pie_chart <- function(tbl){"
"0","  "
"0","  tbl %>% "
"0","    mutate(prop = value / sum(value)) %>%"
"0","    mutate(label = str_to_title(sex_modifier)) %>% "
"0","    ggplot(aes(x ="""", y = prop, fill = sex_modifier)) + "
"0","    geom_col(width = 1, colour = ""white"") + "
"0","    coord_polar(""y"", start = 0) + "
"0","    theme_void() + "
"0","    geom_label(aes(y = prop, "
"0","                   label = paste0(label, ""\n"", "
"0","                                  comma(value), "
"0","                                  ""\n"", "
"0","                                  percent(prop, accuracy = .1))), "
"0","               colour = ""white"", "
"0","               position = position_stack(vjust = .5), "
"0","               size = 5) + "
"0","    scale_fill_manual(values = c( ""#4d6bbd"", ""#ed6b24"")) +"
"0","    theme(legend.position = ""none"", "
"0","        plot.title = element_text(size = 15), "
"0","        plot.subtitle = element_text(size = 30,"
"0","                                     colour = ""#5370BF"")) "
"0"," "
"0","}"
"0",""
"0","make_dodged_plot <- function(tbl) {"
"0","  "
"0","  tbl %>% "
"0","    mutate(age_modifier = str_to_title(age_modifier),"
"0","           age_modifier = str_replace_all(age_modifier, ""Preprimary_ece"", ""Pre-primary\n/ECE""),"
"0","           county = fct_relevel(county, c(""national"", params$county_selection))) %>%"
"0","    mutate(age_modifier = fct_relevel(age_modifier, c(""Secondary"","
"0","                                                      ""Primary"","
"0","                                                      ""Pre-primary\n/ECE""))) %>% "
"0","    arrange(age_modifier, county) %>% "
"0","    ggplot(aes(x = value, y = age_modifier, fill = fct_rev(county))) +"
"0","    geom_col(position = position_dodge()) + "
"0","    geom_text(aes(label = value), position = position_dodge(width = .9), "
"0","              hjust = 1, colour = ""white"", size = 5) + "
"0","    scale_fill_manual(values = c(""#2b54ad"", ""#5d90d3""), "
"0","                      breaks = c(params$county_selection, ""National"")) + "
"0","    theme(legend.position = ""top"",  "
"0","          panel.background = element_rect(""#f4f4f4""), "
"0","          legend.text = element_text(size = 8), "
"0","          plot.title = element_text(size = 15), "
"0","          plot.subtitle = element_text(size = 15), "
"0","          axis.text.y = element_text(size = 10)) + "
"0","    guides(fill = guide_legend(override.aes = list(size = 0.3)))"
"0","}"
"0",""
"0","# counties %>% write_csv(""./data/counties_complete.csv"")"
"0",""
