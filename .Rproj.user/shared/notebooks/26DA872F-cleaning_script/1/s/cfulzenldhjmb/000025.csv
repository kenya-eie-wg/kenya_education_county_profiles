"0","tab2b <- read_xlsx(""./data/try_this_one.xlsx"", "
"0","                  sheet = 1, skip = 14) %>% "
"0","  slice(1:19) %>% "
"0","  setNames("
"0","    c(""indicator"", "
"0","  ""preprimary_ece_female"", "
"0","  ""preprimary_ece_male"", "
"0","  ""preprimary_ece_total"", "
"0","  ""primary_female"", "
"0","  ""primary_male"", "
"0","  ""primary_total"", "
"0","  ""secondary_female"", "
"0","  ""secondary_male"", "
"0","  ""secondary_total"", "
"0","  ""national_average"")"
"0","  ) %>% "
"0","  filter(!is.na(indicator) | !is.na(national_average)) %>% "
"0","  fill(indicator) %>% "
"0","  mutate_at(vars(indicator, preprimary_ece_total), "
"0","            ~ gsub(""\\[.*?\\]"", """", .)) %>% "
"0","    pivot_longer(cols = c(preprimary_ece_female:national_average), "
"0","                 names_to = ""modifier"", "
"0","                 values_to = ""value"") %>% "
"0","  group_by(indicator) %>%  "
"0","  tidyr::fill(value) %>% "
"0","  filter("
"0","    indicator %out% c(""Number of education Institutions"", "
"0","                     ""Gender Parity Index"", "
"0","                     ""Learner to teacher Ratio"", "
"0","                     ""Learner-Classroom Ratio"", "
"0","                     ""Percentage of students with no access to improved water source"")) %>% "
"0","  mutate(sex_modifier = case_when(str_detect(modifier, ""female"") ~ ""female"", "
"0","                                      str_detect(modifier, ""male"") ~ ""male"", "
"0","                                      str_detect(modifier, ""total"") ~ ""total"","
"0","                                  TRUE ~ ""total""), "
"0","         age_modifier = case_when(str_detect(modifier, ""preprimary_ece"") ~ ""preprimary_ece"", "
"0","                                  str_detect(modifier, ""primary"") ~ ""primary"","
"0","                                  str_detect(modifier, ""secondary"") ~ ""secondary"","
"0","                                  str_detect(modifier, ""national"") ~ ""national_average"", "
"0","                                        TRUE ~ ""total"")) %>% "
"0","  naniar::replace_with_na(list(value = ""NA"")) %>%  "
"0","  # Figure out later how to deal with the duplications "
"0","  filter(!str_detect(value, "":"") | age_modifier == ""national_average"") %>% "
"0","  mutate(indicator = "
"0","           case_when("
"0","             str_detect(indicator, ""Enrolment"") & "
"0","               !str_detect(indicator, ""Rate"") & "
"0","               row_number() <=10 ~ ""Enrolment 2022 Term 2"","
"0","             str_detect(indicator, ""Enrolment"") & "
"0","               !str_detect(indicator, ""Rate"") & "
"0","               row_number() >= 11 & "
"0","               row_number() < 22 ~ ""Enrolment 2022 Term 3"", "
"0","             TRUE ~ indicator)) %>% "
"0","  mutate(geography = ifelse(str_detect(age_modifier, ""national""), ""national"", ""county"")) %>% "
"0","  select(indicator, value, age_modifier, sex_modifier, geography) "
"2","New names:"
