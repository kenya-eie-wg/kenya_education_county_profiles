filter(county != "National") %>%
filter(sex_modifier == "female") %>%
pivot_wider(names_from = age_modifier,
values_from = value)
counties %>%
filter(str_detect(indicator, "GBV|Pregnancy")) %>%
pivot_wider(names_from = age_modifier,
values_from = values) %>%
setNames(c("age_modifier", "sex_modifier", "county", "net_enrolment_rate",
"teenage_pregnancy", "experienced_physical_violence", "experienced_sexual_violence"))
counties %>%
filter(str_detect(indicator, "GBV|Pregnancy")) %>%
pivot_wider(names_from = age_modifier,
values_from = value) %>%
setNames(c("age_modifier", "sex_modifier", "county", "net_enrolment_rate",
"teenage_pregnancy", "experienced_physical_violence", "experienced_sexual_violence"))
counties %>%
filter(str_detect(indicator, "GBV|Pregnancy")) %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
setNames(c("age_modifier", "sex_modifier", "county", "net_enrolment_rate",
"teenage_pregnancy", "experienced_physical_violence", "experienced_sexual_violence"))
counties %>%
filter(str_detect(indicator, "GBV|Pregnancy")) %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
setNames(c("age_modifier", "sex_modifier", "county",
"teenage_pregnancy", "experienced_physical_violence", "experienced_sexual_violence"))
counties %>%
filter(str_detect(indicator, "Enrolment")) %>%
filter(county != "National" & sex_modifier == "female") %>%
pivot_wider(names_from = age_modifier,
values_from = value,
names_prefix = "enrolment_female_")
counties %>%
filter(str_detect(indicator, "GBV|Pregnancy")) %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
setNames(c("age_modifier", "sex_modifier", "county",
"teenage_pregnancy", "experienced_physical_violence", "experienced_sexual_violence")) %>%
left_join(
counties %>%
filter(str_detect(indicator, "Enrolment")) %>%
filter(county != "National" & sex_modifier == "female") %>%
pivot_wider(
names_from = age_modifier,
values_from = value,
names_prefix = "enrolment_female_"
) %>%
select(-indicator,-sex_modifier),
by = "county"
)
gbv_enrol <- counties %>%
filter(str_detect(indicator, "GBV|Pregnancy")) %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
setNames(c("age_modifier", "sex_modifier", "county",
"teenage_pregnancy", "experienced_physical_violence", "experienced_sexual_violence")) %>%
left_join(
counties %>%
filter(str_detect(indicator, "Enrolment")) %>%
filter(county != "National" & sex_modifier == "female") %>%
pivot_wider(
names_from = age_modifier,
values_from = value,
names_prefix = "enrolment_female_"
) %>%
select(-indicator,-sex_modifier),
by = "county"
)
knitr::opts_chunk$set(echo = FALSE, fig.retina = 2)
library(tidyverse)
library(viridis)
library(readxl)
library(sf)
library(scales)
library(patchwork)
library(janitor)
library(flextable)
library(tidytext)
library(grid)
theme_set(theme_light())
# Hopefully this allows the DT to show up
options(htmltools.preserve.raw = FALSE)
# disabling scientific notation
options(scipen = 100)
`%out%` <- Negate(`%in%`)
# function for transposing df
transpose_df <- function(df) {
t_df <- data.table::transpose(df)
colnames(t_df) <- rownames(df)
rownames(t_df) <- colnames(df)
t_df <- t_df %>%
tibble::rownames_to_column(.data = .) %>%
tibble::as_tibble(.)
return(t_df)
}
# scaling functions
range01 <- function(x){(x-min(x))/(max(x)-min(x))}
range_wna <- function(x){(x-min(x, na.rm = TRUE))/(max(x, na.rm = TRUE)-min(x, na.rm = TRUE))}
#mode function
mode <- function(x) {
ux <- unique(x)
ux[which.max(tabulate(match(x, ux)))]
}
not_all_na <- function(x) any(!is.na(x))
not_any_na <- function(x) all(!is.na(x))
locations <- read_xlsx("./data/ken_adminboundaries_tabulardata.xlsx",
sheet = "ADM1") %>%
clean_names()
pcode1_shape <-
sf::st_read("./data/ken_adm_iebc_20191031_shp/ken_admbnda_adm1_iebc_20191031.shp",
quiet = TRUE) %>%
clean_names()
counties <- read_csv("./data/counties.csv") %>%
mutate(sex_modifier = fct_relevel(sex_modifier, c("male", "female", "total"))) %>%
# Important -- the old values were wrong
rbind(read_csv("./data/learner_toilet_ratio_recalculated.csv") %>%
filter(county %in% c(asal_county_list)) %>%
mutate(indicator = "learner_toilet_ratio_recalculated") %>%
select(indicator, county, age_modifier, sex_modifier, value = learner_toilet_ratio)) %>%
mutate(age_modifier = ifelse(age_modifier == "preprimary",
"preprimary_ece",
age_modifier),
county = recode(county,
"national" = "National",
"Tharaka Nithi" = "Tharaka-Nithi"))
locations <- read_xlsx("./data/ken_adminboundaries_tabulardata.xlsx",
sheet = "ADM1") %>%
clean_names()
pcode1_shape <-
sf::st_read("./data/ken_adm_iebc_20191031_shp/ken_admbnda_adm1_iebc_20191031.shp",
quiet = TRUE) %>%
clean_names()
asal_county_list <- counties %>% distinct(county) %>% pull()
locations <- read_xlsx("./data/ken_adminboundaries_tabulardata.xlsx",
sheet = "ADM1") %>%
clean_names()
pcode1_shape <-
sf::st_read("./data/ken_adm_iebc_20191031_shp/ken_admbnda_adm1_iebc_20191031.shp",
quiet = TRUE) %>%
clean_names()
asal_county_list <- read_csv("./data/counties.csv") %>% distinct(county) %>% pull()
counties <- read_csv("./data/counties.csv") %>%
mutate(sex_modifier = fct_relevel(sex_modifier, c("male", "female", "total"))) %>%
# Important -- the old values were wrong
rbind(read_csv("./data/learner_toilet_ratio_recalculated.csv") %>%
filter(county %in% c(asal_county_list)) %>%
mutate(indicator = "learner_toilet_ratio_recalculated") %>%
select(indicator, county, age_modifier, sex_modifier, value = learner_toilet_ratio)) %>%
mutate(age_modifier = ifelse(age_modifier == "preprimary",
"preprimary_ece",
age_modifier),
county = recode(county,
"national" = "National",
"Tharaka Nithi" = "Tharaka-Nithi"))
counties %>%
filter(indicator %in% c("county_population", "school_age_children") &
sex_modifier == "total") %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
mutate(pc = school_age_children / county_population * 100) %>%
ggplot(aes(x = school_age_children, y = fct_rev(fct_relevel(county, population_sort_order)), fill = pc)) +
geom_col() +
geom_text(aes(label = comma(school_age_children)),
colour = "grey20",
size = 4,
hjust = 1) +
# scale_fill_viridis(option = "cividis", begin = .4) +
scale_fill_brewer(palette = "Greens") +
scale_x_continuous(labels = comma) +
labs(x = "School-aged children",
y = "",
fill = "% of county\npopulation",
title = "Number of school-aged children in ASAL counties") +
theme(legend.title = element_text(size = 8))
pop_summary <- counties %>%
filter(indicator %in% c("county_population", "school_age_children") &
sex_modifier == "total") %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
mutate(pc = school_age_children / county_population * 100)
population_sort_order <- counties %>%
filter(indicator %in% c("county_population", "school_age_children") &
sex_modifier == "total") %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
mutate(pc = school_age_children / county_population * 100) %>%
arrange(desc(school_age_children)) %>%
pull(county)
counties %>%
filter(indicator %in% c("county_population", "school_age_children") &
sex_modifier == "total") %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
mutate(pc = school_age_children / county_population * 100) %>%
ggplot(aes(x = school_age_children, y = fct_rev(fct_relevel(county, population_sort_order)), fill = pc)) +
geom_col() +
geom_text(aes(label = comma(school_age_children)),
colour = "grey20",
size = 4,
hjust = 1) +
# scale_fill_viridis(option = "cividis", begin = .4) +
scale_fill_brewer(palette = "Greens") +
scale_x_continuous(labels = comma) +
labs(x = "School-aged children",
y = "",
fill = "% of county\npopulation",
title = "Number of school-aged children in ASAL counties") +
theme(legend.title = element_text(size = 8))
counties %>%
filter(indicator %in% c("county_population", "school_age_children") &
sex_modifier == "total") %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
mutate(pc = school_age_children / county_population * 100) %>%
ggplot(aes(x = school_age_children, y = fct_rev(fct_relevel(county, population_sort_order)), fill = pc)) +
geom_col() +
geom_text(aes(label = comma(school_age_children)),
colour = "grey20",
size = 4,
hjust = 1) +
# scale_fill_viridis(option = "cividis", begin = .4) +
scale_fill_manual(values = c("#000000", "#736F6E",
"#C0C0C0", "#98AFC7", "#6698FF", "#153E7E"))+
scale_x_continuous(labels = comma) +
labs(x = "School-aged children",
y = "",
fill = "% of county\npopulation",
title = "Number of school-aged children in ASAL counties") +
theme(legend.title = element_text(size = 8))
counties %>%
filter(indicator %in% c("county_population", "school_age_children") &
sex_modifier == "total") %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
mutate(pc = school_age_children / county_population * 100) %>%
ggplot(aes(x = school_age_children, y = fct_rev(fct_relevel(county, population_sort_order)), fill = pc)) +
geom_col() +
geom_text(aes(label = comma(school_age_children)),
colour = "grey20",
size = 4,
hjust = 1) +
# scale_fill_viridis(option = "cividis", begin = .4) +
scale_fill_gradientn(colours = terrain.colors(10))
counties %>%
filter(indicator %in% c("county_population", "school_age_children") &
sex_modifier == "total") %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
mutate(pc = school_age_children / county_population * 100) %>%
ggplot(aes(x = school_age_children, y = fct_rev(fct_relevel(county, population_sort_order)), fill = pc)) +
geom_col() +
geom_text(aes(label = comma(school_age_children)),
colour = "grey20",
size = 4,
hjust = 1) +
# scale_fill_viridis(option = "cividis", begin = .4) +
scale_fill_gradientn(colours = terrain.colors(10)) +
scale_x_continuous(labels = comma) +
labs(x = "School-aged children",
y = "",
fill = "% of county\npopulation",
title = "Number of school-aged children in ASAL counties") +
theme(legend.title = element_text(size = 8))
counties %>%
filter(indicator %in% c("county_population", "school_age_children") &
sex_modifier == "total") %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
mutate(pc = school_age_children / county_population * 100) %>%
ggplot(aes(x = school_age_children, y = fct_rev(fct_relevel(county, population_sort_order)), fill = pc)) +
geom_col() +
geom_text(aes(label = comma(school_age_children)),
colour = "grey20",
size = 4,
hjust = 1) +
# scale_fill_viridis(option = "cividis", begin = .4) +
scale_fill_gradient2() +
scale_x_continuous(labels = comma) +
labs(x = "School-aged children",
y = "",
fill = "% of county\npopulation",
title = "Number of school-aged children in ASAL counties") +
theme(legend.title = element_text(size = 8))
install.packages("wesanderson")
library(wesanderson)
counties %>%
filter(indicator %in% c("county_population", "school_age_children") &
sex_modifier == "total") %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
mutate(pc = school_age_children / county_population * 100) %>%
ggplot(aes(x = school_age_children, y = fct_rev(fct_relevel(county, population_sort_order)), fill = pc)) +
geom_col() +
geom_text(aes(label = comma(school_age_children)),
colour = "grey20",
size = 4,
hjust = 1) +
scale_fill_gradient(colours = wes_palette("Zissou1", 100, type = "continuous")) +
scale_x_continuous(labels = comma) +
labs(x = "School-aged children",
y = "",
fill = "% of county\npopulation",
title = "Number of school-aged children in ASAL counties") +
theme(legend.title = element_text(size = 8))
counties %>%
filter(indicator %in% c("county_population", "school_age_children") &
sex_modifier == "total") %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
mutate(pc = school_age_children / county_population * 100) %>%
ggplot(aes(x = school_age_children, y = fct_rev(fct_relevel(county, population_sort_order)), fill = pc)) +
geom_col() +
geom_text(aes(label = comma(school_age_children)),
colour = "grey20",
size = 4,
hjust = 1) +
scale_fill_gradient(colours = wes_palette("Zissou1", 10, type = "continuous")) +
scale_x_continuous(labels = comma) +
labs(x = "School-aged children",
y = "",
fill = "% of county\npopulation",
title = "Number of school-aged children in ASAL counties") +
theme(legend.title = element_text(size = 8))
counties %>%
filter(indicator %in% c("county_population", "school_age_children") &
sex_modifier == "total") %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
mutate(pc = school_age_children / county_population * 100) %>%
ggplot(aes(x = school_age_children, y = fct_rev(fct_relevel(county, population_sort_order)), fill = pc)) +
geom_col() +
geom_text(aes(label = comma(school_age_children)),
colour = "grey20",
size = 4,
hjust = 1) +
# scale_fill_gradient(colours = wes_palette("Zissou1", 10, type = "continuous")) +
scale_x_continuous(labels = comma) +
labs(x = "School-aged children",
y = "",
fill = "% of county\npopulation",
title = "Number of school-aged children in ASAL counties") +
theme(legend.title = element_text(size = 8))
counties %>%
filter(indicator %in% c("county_population", "school_age_children") &
sex_modifier == "total") %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
mutate(pc = school_age_children / county_population * 100) %>%
ggplot(aes(x = school_age_children, y = fct_rev(fct_relevel(county, population_sort_order)), fill = pc)) +
geom_col() +
geom_text(aes(label = comma(school_age_children)),
colour = "grey20",
size = 4,
hjust = 1) +
scale_fill_viridis(trans = "log10") +
# scale_fill_gradient(colours = wes_palette("Zissou1", 10, type = "continuous")) +
scale_x_continuous(labels = comma) +
labs(x = "School-aged children",
y = "",
fill = "% of county\npopulation",
title = "Number of school-aged children in ASAL counties") +
theme(legend.title = element_text(size = 8))
counties %>%
filter(indicator %in% c("county_population", "school_age_children") &
sex_modifier == "total") %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
mutate(pc = school_age_children / county_population * 100) %>%
ggplot(aes(x = school_age_children, y = fct_rev(fct_relevel(county, population_sort_order)), fill = pc)) +
geom_col() +
geom_text(aes(label = comma(school_age_children)),
colour = "grey20",
size = 4,
hjust = 1) +
scale_fill_viridis(trans = "log10",
start = .2) +
# scale_fill_gradient(colours = wes_palette("Zissou1", 10, type = "continuous")) +
scale_x_continuous(labels = comma) +
labs(x = "School-aged children",
y = "",
fill = "% of county\npopulation",
title = "Number of school-aged children in ASAL counties") +
theme(legend.title = element_text(size = 8))
counties %>%
filter(indicator %in% c("county_population", "school_age_children") &
sex_modifier == "total") %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
mutate(pc = school_age_children / county_population * 100) %>%
ggplot(aes(x = school_age_children, y = fct_rev(fct_relevel(county, population_sort_order)), fill = pc)) +
geom_col() +
geom_text(aes(label = comma(school_age_children)),
colour = "grey20",
size = 4,
hjust = 1) +
scale_fill_viridis(trans = "log10",
begin = .2) +
# scale_fill_gradient(colours = wes_palette("Zissou1", 10, type = "continuous")) +
scale_x_continuous(labels = comma) +
labs(x = "School-aged children",
y = "",
fill = "% of county\npopulation",
title = "Number of school-aged children in ASAL counties") +
theme(legend.title = element_text(size = 8))
counties %>%
filter(indicator %in% c("county_population", "school_age_children") &
sex_modifier == "total") %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
mutate(pc = school_age_children / county_population * 100) %>%
ggplot(aes(x = school_age_children, y = fct_rev(fct_relevel(county, population_sort_order)), fill = pc)) +
geom_col() +
geom_text(aes(label = comma(school_age_children)),
colour = "grey20",
size = 4,
hjust = 1) +
scale_fill_viridis(trans = "log10",
begin = .2,
breaks = c(30, 40, 50, 70)) +
# scale_fill_gradient(colours = wes_palette("Zissou1", 10, type = "continuous")) +
scale_x_continuous(labels = comma) +
labs(x = "School-aged children",
y = "",
fill = "% of county\npopulation",
title = "Number of school-aged children in ASAL counties") +
theme(legend.title = element_text(size = 8))
counties %>%
filter(indicator %in% c("county_population", "school_age_children") &
sex_modifier == "total") %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
mutate(pc = school_age_children / county_population * 100) %>%
ggplot(aes(x = school_age_children, y = fct_rev(fct_relevel(county, population_sort_order)), fill = pc)) +
geom_col() +
geom_text(aes(label = comma(school_age_children)),
colour = "grey20",
size = 4,
hjust = 1) +
scale_fill_viridis(begin = .2,
breaks = c(30, 40, 50, 70)) +
# scale_fill_gradient(colours = wes_palette("Zissou1", 10, type = "continuous")) +
scale_x_continuous(labels = comma) +
labs(x = "School-aged children",
y = "",
fill = "% of county\npopulation",
title = "Number of school-aged children in ASAL counties") +
theme(legend.title = element_text(size = 8))
counties %>%
filter(indicator %in% c("county_population", "school_age_children") &
sex_modifier == "total") %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
mutate(pc = school_age_children / county_population * 100) %>%
ggplot(aes(x = school_age_children, y = fct_rev(fct_relevel(county, population_sort_order)), fill = pc)) +
geom_col() +
geom_text(aes(label = comma(school_age_children)),
colour = "grey40",
size = 4,
hjust = 1) +
scale_fill_viridis(begin = .2,
breaks = c(30, 40, 50, 70)) +
# scale_fill_gradient(colours = wes_palette("Zissou1", 10, type = "continuous")) +
scale_x_continuous(labels = comma) +
labs(x = "School-aged children",
y = "",
fill = "% of county\npopulation",
title = "Number of school-aged children in ASAL counties") +
theme(legend.title = element_text(size = 8))
counties %>%
filter(indicator %in% c("county_population", "school_age_children") &
sex_modifier == "total") %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
mutate(pc = school_age_children / county_population * 100) %>%
ggplot(aes(x = school_age_children, y = fct_rev(fct_relevel(county, population_sort_order)), fill = pc)) +
geom_col() +
geom_text(aes(label = comma(school_age_children)),
colour = "grey20",
size = 4,
hjust = 1) +
scale_fill_viridis(begin = .2,
breaks = c(30, 40, 50, 70)) +
# scale_fill_gradient(colours = wes_palette("Zissou1", 10, type = "continuous")) +
scale_x_continuous(labels = comma) +
labs(x = "School-aged children",
y = "",
fill = "% of county\npopulation",
title = "Number of school-aged children in ASAL counties") +
theme(legend.title = element_text(size = 8))
counties %>%
filter(indicator %in% c("county_population", "school_age_children") &
sex_modifier == "total") %>%
pivot_wider(names_from = indicator,
values_from = value) %>%
mutate(pc = school_age_children / county_population * 100) %>%
ggplot(aes(x = school_age_children, y = fct_rev(fct_relevel(county, population_sort_order)), fill = pc)) +
geom_col() +
geom_text(aes(label = comma(school_age_children)),
colour = "black",
size = 4,
hjust = 1) +
scale_fill_viridis(begin = .2,
breaks = c(30, 40, 50, 70)) +
# scale_fill_gradient(colours = wes_palette("Zissou1", 10, type = "continuous")) +
scale_x_continuous(labels = comma) +
labs(x = "School-aged children",
y = "",
fill = "% of county\npopulation",
title = "Number of school-aged children in ASAL counties") +
theme(legend.title = element_text(size = 8))
