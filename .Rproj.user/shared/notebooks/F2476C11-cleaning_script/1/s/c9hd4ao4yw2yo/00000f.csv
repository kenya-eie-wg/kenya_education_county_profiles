"0",""
"0","read_table <- function(i) {"
"0","  "
"0","  county_name <- (read_xlsx(""./data/county_profiles_raw.xlsx"", "
"0","                         sheet = i) %>%"
"0","                    names())[1] %>%"
"0","    {str_replace_all(., "" County- Education Profile"", """")}"
"0","  "
"0","  bind_rows("
"0","    read_xlsx(""./data/county_profiles_raw.xlsx"","
"0","              sheet = i, skip = 14) %>%"
"0","      slice(1:27) %>%  "
"0","      setNames("
"0","        c(""indicator"", "
"0","      ""preprimary_ece_female"", "
"0","      ""preprimary_ece_male"", "
"0","      ""preprimary_ece_total"", "
"0","      ""primary_female"", "
"0","      ""primary_male"", "
"0","      ""primary_total"", "
"0","      ""secondary_female"", "
"0","      ""secondary_male"", "
"0","      ""secondary_total"", "
"0","      ""national_average"")"
"0","      ) %>% "
"0","      select(-national_average) %>% "
"0","      mutate_at(vars(indicator), ~ str_trim(str_squish(.))) %>% "
"0","      mutate_at(vars(indicator), "
"0","                ~ gsub(""\\[.*?\\]"", """", .)) %>% "
"0","      filter(!is.na(indicator) & !str_detect(indicator, ""WASH in"")) %>% "
"0","      pivot_longer(cols = c(preprimary_ece_female:secondary_total), "
"0","                     names_to = ""modifier"", "
"0","                     values_to = ""value"") %>% "
"0","      filter("
"0","        indicator %in% c(""Number of education Institutions (Public & Private)"", "
"0","                         ""Gender Parity Index"", "
"0","                         ""Learner to teacher Ratio in Public Schools"", "
"0","                         ""Learner to Toilet Ratio in Public Schools"", "
"0","                         ""Learner-Classroom Ratio in Public Schools"", "
"0","                         ""Percentage of students with no access to improved water source"", "
"0","                         ""Number of schools with no water source"")) %>% "
"0","      fill(value) %>% "
"0","      filter(str_detect(modifier, ""total"")) %>% "
"0","      mutate(modifier = ifelse(str_detect(indicator, ""water source""), "
"0","                               NA_character_, "
"0","                               modifier)) %>% "
"0","      distinct(indicator, modifier, value) %>% "
"0","      mutate(sex_modifier = ""total"", "
"0","             age_modifier = str_remove_all(modifier, ""_total""), "
"0","             value = as.numeric(value)) %>% "
"0","      select(-modifier),  "
"0","    "
"0","    read_xlsx(""./data/county_profiles_raw.xlsx"","
"0","              sheet = i, skip = 14) %>%"
"0","      slice(1:27) %>%  "
"0","      setNames("
"0","        c(""indicator"", "
"0","      ""preprimary_ece_female"", "
"0","      ""preprimary_ece_male"", "
"0","      ""preprimary_ece_total"", "
"0","      ""primary_female"", "
"0","      ""primary_male"", "
"0","      ""primary_total"", "
"0","      ""secondary_female"", "
"0","      ""secondary_male"", "
"0","      ""secondary_total"", "
"0","      ""national_average"")"
"0","      ) %>% "
"0","      select(-national_average) %>% "
"0","      mutate_at(vars(indicator), ~ str_trim(str_squish(.))) %>% "
"0","      mutate_at(vars(indicator), "
"0","                ~ gsub(""\\[.*?\\]"", """", .)) %>% "
"0","      filter(!is.na(indicator) & !str_detect(indicator, ""WASH in"")) %>% "
"0","      pivot_longer(cols = c(preprimary_ece_female:secondary_total), "
"0","                     names_to = ""modifier"", "
"0","                     values_to = ""value"") %>% "
"0","      filter("
"0","        indicator %in% c(""Net Enrolment Rate (NER)"", "
"0","                         ""Students’ dropout /Absenteeism during"", "
"0","                         ""Primary-to-Secondary Transition Rate"")| "
"0","          str_detect(indicator, ""Learner to Toilet""))  %>% "
"0","      mutate(indicator = recode(indicator, "
"0","                                ""Students’ dropout /Absenteeism during"" ="
"0","                                  ""Students' dropout/Absenteeism during 2022"")) %>% "
"0","      distinct(indicator, modifier, value) %>% "
"0","      mutate(sex_modifier = case_when(str_detect(modifier, ""female"") ~ ""female"", "
"0","                                      str_detect(modifier, ""male"") ~ ""male"", "
"0","                                      str_detect(modifier, ""total"") ~ ""total""), "
"0","             age_modifier = case_when(str_detect(modifier, ""preprimary_ece"") ~ ""preprimary_ece"", "
"0","                                      str_detect(modifier, ""primary"") ~ ""primary"", "
"0","                                      str_detect(modifier, ""secondary"") ~ ""secondary""), "
"0","             value = as.numeric(value)) %>% "
"0","      select(-modifier) %>%"
"0","      filter(!is.na(value)), "
"0",""
"0","  read_xlsx(""./data/county_profiles_raw.xlsx"", "
"0","                    sheet = i, skip = 3) %>% "
"0","    setNames("
"0","      c(""county_population_females"", "
"0","    ""county_population_males"", "
"0","    ""county_population_total"", "
"0","    ""school_age_children_females"", "
"0","    ""school_age_children_males"", "
"0","    ""school_age_children_total"", "
"0","    ""out_of_school_preprimary_ece_females"", "
"0","    ""out_of_school_preprimary_ece_males"", "
"0","    ""out_of_school_preprimary_ece_total"","
"0","    ""out_of_school_primary_females"", "
"0","    ""out_of_school_primary_males"", "
"0","    ""out_of_school_primary_total"", "
"0","    ""out_of_school_secondary_females"", "
"0","    ""out_of_school_secondary_males"", "
"0","    ""out_of_school_secondary_total"""
"0","    ))%>% "
"0","      slice(2) %>% "
"0","    transpose_df() %>% "
"0","    setNames(c(""indicator"", ""value"")) %>% "
"0","    mutate(sex_modifier = case_when(str_detect(indicator, ""female"") ~ ""female"", "
"0","                                        str_detect(indicator, ""male"") ~ ""male"", "
"0","                                        str_detect(indicator, ""total"") ~ ""total"", "
"0","                                        TRUE ~ ""total""), "
"0","           age_modifier = case_when(str_detect(indicator, ""preprimary_ece"") ~ ""preprimary_ece"","
"0","                                    str_detect(indicator, ""primary"") ~ ""primary"","
"0","                                    str_detect(indicator, ""secondary"") ~ ""secondary"", "
"0","                                    TRUE ~ ""total""))  %>% "
"0","    mutate(indicator = str_remove_all(indicator, ""_females|_males|_total|_preprimary_ece|_primary|_secondary""), "
"0","           indicator = ifelse(indicator == ""out_of_school"", ""out_of_school_children"", indicator), "
"0","             value = as.numeric(value)), "
"0","  "
"0","  read_xlsx(""./data/county_profiles_raw.xlsx"", "
"0","                    sheet = i, skip = 7) %>% "
"0","    slice(1:3) %>%"
"0","    clean_names() %>% "
"0","    rename(indicator = child_protection_indicator_4, "
"0","           value = percentage) %>% "
"0","    select(where(not_all_na)) %>% "
"0","    mutate(sex_modifier = ""female"", "
"0","           age_modifier = ""total"","
"0","           indicator = str_replace_all(indicator, ""Isolo"", ""Isiolo""), "
"0","           indicator = str_remove(indicator, "
"0","                                  paste0("" in "", county_name, "" County"")), "
"0","           indicator = str_remove(indicator, "
"0","                                  paste0("" in "", county_name, "" county"")),"
"0","             value = as.numeric(value))"
"0","  "
"0","  ) %>% "
"0","    "
"0","    mutate(county = ifelse(str_detect(indicator, ""Kenya|national""), "
"0","                           ""national"", "
"0","                           paste0(county_name)))"
"0","    "
"0","}"
"0",""
"0",""
"0","     "
"0","  "
"0",""
"0",""
