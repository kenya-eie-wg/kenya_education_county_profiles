filter(
indicator %in% c("Net Enrolment Rate (NER)",
"Students’ dropout /Absenteeism during")|
str_detect(indicator, "Learner to Toilet"))
fill(value) %>%
mutate(indicator = recode(indicator,
"Students’ dropout /Absenteeism during" =
"Students' dropout/Absenteeism during 2022")) %>%
distinct(indicator, modifier, value) %>%
mutate(sex_modifier = case_when(str_detect(modifier, "male") ~ "male",
str_detect(modifier, "female") ~ "female",
str_detect(modifier, "total") ~ "total"),
age_modifier = case_when(str_detect(modifier, "preprimary_ece") ~ "preprimary_ece",
str_detect(modifier, "primary") ~ "primary",
str_detect(modifier, "secondary") ~ "secondary"),
value = as.numeric(value)) %>%
select(-modifier)
read_xlsx("./data/county_profiles_raw.xlsx",
sheet = 1, skip = 14) %>%
slice(1:26) %>%
setNames(
c("indicator",
"preprimary_ece_female",
"preprimary_ece_male",
"preprimary_ece_total",
"primary_female",
"primary_male",
"primary_total",
"secondary_female",
"secondary_male",
"secondary_total",
"national_average")
) %>%
select(-national_average) %>%
mutate_at(vars(indicator), ~ str_trim(str_squish(.))) %>%
mutate_at(vars(indicator),
~ gsub("\\[.*?\\]", "", .)) %>%
filter(!is.na(indicator) & !str_detect(indicator, "WASH in")) %>%
pivot_longer(cols = c(preprimary_ece_female:secondary_total),
names_to = "modifier",
values_to = "value") %>%
filter(
indicator %in% c("Net Enrolment Rate (NER)",
"Students’ dropout /Absenteeism during")|
str_detect(indicator, "Learner to Toilet"))  %>%
mutate(indicator = recode(indicator,
"Students’ dropout /Absenteeism during" =
"Students' dropout/Absenteeism during 2022")) %>%
distinct(indicator, modifier, value) %>%
mutate(sex_modifier = case_when(str_detect(modifier, "male") ~ "male",
str_detect(modifier, "female") ~ "female",
str_detect(modifier, "total") ~ "total"),
age_modifier = case_when(str_detect(modifier, "preprimary_ece") ~ "preprimary_ece",
str_detect(modifier, "primary") ~ "primary",
str_detect(modifier, "secondary") ~ "secondary"),
value = as.numeric(value)) %>%
select(-modifier)
read_xlsx("./data/county_profiles_raw.xlsx",
sheet = 1, skip = 14) %>%
slice(1:26) %>%
setNames(
c("indicator",
"preprimary_ece_female",
"preprimary_ece_male",
"preprimary_ece_total",
"primary_female",
"primary_male",
"primary_total",
"secondary_female",
"secondary_male",
"secondary_total",
"national_average")
) %>%
select(-national_average) %>%
mutate_at(vars(indicator), ~ str_trim(str_squish(.))) %>%
mutate_at(vars(indicator),
~ gsub("\\[.*?\\]", "", .)) %>%
filter(!is.na(indicator) & !str_detect(indicator, "WASH in")) %>%
pivot_longer(cols = c(preprimary_ece_female:secondary_total),
names_to = "modifier",
values_to = "value") %>%
filter(
indicator %in% c("Net Enrolment Rate (NER)",
"Students’ dropout /Absenteeism during")|
str_detect(indicator, "Learner to Toilet"))  %>%
mutate(indicator = recode(indicator,
"Students’ dropout /Absenteeism during" =
"Students' dropout/Absenteeism during 2022")) %>%
distinct(indicator, modifier, value) %>%
mutate(sex_modifier = case_when(str_detect(modifier, "female") ~ "female",
str_detect(modifier, "male") ~ "male",
str_detect(modifier, "total") ~ "total"),
age_modifier = case_when(str_detect(modifier, "preprimary_ece") ~ "preprimary_ece",
str_detect(modifier, "primary") ~ "primary",
str_detect(modifier, "secondary") ~ "secondary"),
value = as.numeric(value)) %>%
select(-modifier)
read_xlsx("./data/county_profiles_raw.xlsx",
sheet = 1, skip = 14) %>%
slice(1:26) %>%
setNames(
c("indicator",
"preprimary_ece_female",
"preprimary_ece_male",
"preprimary_ece_total",
"primary_female",
"primary_male",
"primary_total",
"secondary_female",
"secondary_male",
"secondary_total",
"national_average")
) %>%
select(-national_average) %>%
mutate_at(vars(indicator), ~ str_trim(str_squish(.))) %>%
mutate_at(vars(indicator),
~ gsub("\\[.*?\\]", "", .)) %>%
filter(!is.na(indicator) & !str_detect(indicator, "WASH in")) %>%
pivot_longer(cols = c(preprimary_ece_female:secondary_total),
names_to = "modifier",
values_to = "value") %>%
filter(
indicator %in% c("Net Enrolment Rate (NER)",
"Students’ dropout /Absenteeism during")|
str_detect(indicator, "Learner to Toilet"))  %>%
mutate(indicator = recode(indicator,
"Students’ dropout /Absenteeism during" =
"Students' dropout/Absenteeism during 2022")) %>%
distinct(indicator, modifier, value) %>%
mutate(sex_modifier = case_when(str_detect(modifier, "female") ~ "female",
str_detect(modifier, "male") ~ "male",
str_detect(modifier, "total") ~ "total"),
age_modifier = case_when(str_detect(modifier, "preprimary_ece") ~ "preprimary_ece",
str_detect(modifier, "primary") ~ "primary",
str_detect(modifier, "secondary") ~ "secondary"),
value = as.numeric(value))
read_xlsx("./data/county_profiles_raw.xlsx",
sheet = 1, skip = 14) %>%
slice(1:26) %>%
setNames(
c("indicator",
"preprimary_ece_female",
"preprimary_ece_male",
"preprimary_ece_total",
"primary_female",
"primary_male",
"primary_total",
"secondary_female",
"secondary_male",
"secondary_total",
"national_average")
) %>%
select(-national_average) %>%
mutate_at(vars(indicator), ~ str_trim(str_squish(.))) %>%
mutate_at(vars(indicator),
~ gsub("\\[.*?\\]", "", .)) %>%
filter(!is.na(indicator) & !str_detect(indicator, "WASH in")) %>%
pivot_longer(cols = c(preprimary_ece_female:secondary_total),
names_to = "modifier",
values_to = "value")
read_xlsx("./data/county_profiles_raw.xlsx",
sheet = 1, skip = 14) %>%
slice(1:26) %>%
setNames(
c("indicator",
"preprimary_ece_female",
"preprimary_ece_male",
"preprimary_ece_total",
"primary_female",
"primary_male",
"primary_total",
"secondary_female",
"secondary_male",
"secondary_total",
"national_average")
) %>%
select(-national_average) %>%
mutate_at(vars(indicator), ~ str_trim(str_squish(.))) %>%
mutate_at(vars(indicator),
~ gsub("\\[.*?\\]", "", .)) %>%
filter(!is.na(indicator) & !str_detect(indicator, "WASH in")) %>%
pivot_longer(cols = c(preprimary_ece_female:secondary_total),
names_to = "modifier",
values_to = "value") %>%
filter(
indicator %in% c("Net Enrolment Rate (NER)",
"Students’ dropout /Absenteeism during",
"Primary-to-Secondary Transition Rate")|
str_detect(indicator, "Learner to Toilet"))  %>%
mutate(indicator = recode(indicator,
"Students’ dropout /Absenteeism during" =
"Students' dropout/Absenteeism during 2022")) %>%
distinct(indicator, modifier, value) %>%
mutate(sex_modifier = case_when(str_detect(modifier, "female") ~ "female",
str_detect(modifier, "male") ~ "male",
str_detect(modifier, "total") ~ "total"),
age_modifier = case_when(str_detect(modifier, "preprimary_ece") ~ "preprimary_ece",
str_detect(modifier, "primary") ~ "primary",
str_detect(modifier, "secondary") ~ "secondary"),
value = as.numeric(value)) %>%
select(-modifier)
read_xlsx("./data/county_profiles_raw.xlsx",
sheet = 1, skip = 14) %>%
slice(1:26) %>%
setNames(
c("indicator",
"preprimary_ece_female",
"preprimary_ece_male",
"preprimary_ece_total",
"primary_female",
"primary_male",
"primary_total",
"secondary_female",
"secondary_male",
"secondary_total",
"national_average")
) %>%
select(-national_average) %>%
mutate_at(vars(indicator), ~ str_trim(str_squish(.))) %>%
mutate_at(vars(indicator),
~ gsub("\\[.*?\\]", "", .)) %>%
filter(!is.na(indicator) & !str_detect(indicator, "WASH in")) %>%
pivot_longer(cols = c(preprimary_ece_female:secondary_total),
names_to = "modifier",
values_to = "value") %>%
filter(
indicator %in% c("Net Enrolment Rate (NER)",
"Students’ dropout /Absenteeism during",
"Primary-to-Secondary Transition Rate")|
str_detect(indicator, "Learner to Toilet"))  %>%
mutate(indicator = recode(indicator,
"Students’ dropout /Absenteeism during" =
"Students' dropout/Absenteeism during 2022")) %>%
distinct(indicator, modifier, value) %>%
mutate(sex_modifier = case_when(str_detect(modifier, "female") ~ "female",
str_detect(modifier, "male") ~ "male",
str_detect(modifier, "total") ~ "total"),
age_modifier = case_when(str_detect(modifier, "preprimary_ece") ~ "preprimary_ece",
str_detect(modifier, "primary") ~ "primary",
str_detect(modifier, "secondary") ~ "secondary"),
value = as.numeric(value)) %>%
select(-modifier) %>%
filter(!is.na(value))
read_table <- function(i) {
county_name <- (read_xlsx("./data/county_profiles_raw.xlsx",
sheet = i) %>%
names())[1] %>%
{str_replace_all(., " County- Education Profile", "")}
bind_rows(
read_xlsx("./data/county_profiles_raw.xlsx",
sheet = i, skip = 14) %>%
slice(1:26) %>%
setNames(
c("indicator",
"preprimary_ece_female",
"preprimary_ece_male",
"preprimary_ece_total",
"primary_female",
"primary_male",
"primary_total",
"secondary_female",
"secondary_male",
"secondary_total",
"national_average")
) %>%
select(-national_average) %>%
mutate_at(vars(indicator), ~ str_trim(str_squish(.))) %>%
mutate_at(vars(indicator),
~ gsub("\\[.*?\\]", "", .)) %>%
filter(!is.na(indicator) & !str_detect(indicator, "WASH in")) %>%
pivot_longer(cols = c(preprimary_ece_female:secondary_total),
names_to = "modifier",
values_to = "value") %>%
filter(
indicator %in% c("Number of education Institutions (Public & Private)",
"Gender Parity Index",
"Learner to teacher Ratio in Public Schools",
"Learner to Toilet Ratio in Public Schools",
"Learner-Classroom Ratio in Public Schools",
"Percentage of students with no access to improved water source",
"Number of schools with no water source")) %>%
fill(value) %>%
filter(str_detect(modifier, "total")) %>%
mutate(modifier = ifelse(str_detect(indicator, "water source"),
NA_character_,
modifier)) %>%
distinct(indicator, modifier, value) %>%
mutate(sex_modifier = "total",
age_modifier = str_remove_all(modifier, "_total"),
value = as.numeric(value)) %>%
select(-modifier),
read_xlsx("./data/county_profiles_raw.xlsx",
sheet = 1, skip = 14) %>%
slice(1:26) %>%
setNames(
c("indicator",
"preprimary_ece_female",
"preprimary_ece_male",
"preprimary_ece_total",
"primary_female",
"primary_male",
"primary_total",
"secondary_female",
"secondary_male",
"secondary_total",
"national_average")
) %>%
select(-national_average) %>%
mutate_at(vars(indicator), ~ str_trim(str_squish(.))) %>%
mutate_at(vars(indicator),
~ gsub("\\[.*?\\]", "", .)) %>%
filter(!is.na(indicator) & !str_detect(indicator, "WASH in")) %>%
pivot_longer(cols = c(preprimary_ece_female:secondary_total),
names_to = "modifier",
values_to = "value") %>%
filter(
indicator %in% c("Net Enrolment Rate (NER)",
"Students’ dropout /Absenteeism during",
"Primary-to-Secondary Transition Rate")|
str_detect(indicator, "Learner to Toilet"))  %>%
mutate(indicator = recode(indicator,
"Students’ dropout /Absenteeism during" =
"Students' dropout/Absenteeism during 2022")) %>%
distinct(indicator, modifier, value) %>%
mutate(sex_modifier = case_when(str_detect(modifier, "female") ~ "female",
str_detect(modifier, "male") ~ "male",
str_detect(modifier, "total") ~ "total"),
age_modifier = case_when(str_detect(modifier, "preprimary_ece") ~ "preprimary_ece",
str_detect(modifier, "primary") ~ "primary",
str_detect(modifier, "secondary") ~ "secondary"),
value = as.numeric(value)) %>%
select(-modifier) %>%
filter(!is.na(value)),
read_xlsx("./data/county_profiles_raw.xlsx",
sheet = i, skip = 3) %>%
setNames(
c("county_population_females",
"county_population_males",
"county_population_total",
"school_age_children_females",
"school_age_children_males",
"school_age_children_total",
"out_of_school_preprimary_ece_females",
"out_of_school_preprimary_ece_males",
"out_of_school_preprimary_ece_total",
"out_of_school_primary_females",
"out_of_school_primary_males",
"out_of_school_primary_total",
"out_of_school_secondary_females",
"out_of_school_secondary_males",
"out_of_school_secondary_total"
))%>%
slice(2) %>%
transpose_df() %>%
setNames(c("indicator", "value")) %>%
mutate(sex_modifier = case_when(str_detect(indicator, "female") ~ "female",
str_detect(indicator, "male") ~ "male",
str_detect(indicator, "total") ~ "total",
TRUE ~ "total"),
age_modifier = case_when(str_detect(indicator, "preprimary_ece") ~ "preprimary_ece",
str_detect(indicator, "primary") ~ "primary",
str_detect(indicator, "secondary") ~ "secondary",
TRUE ~ "total"))  %>%
mutate(indicator = str_remove_all(indicator, "_females|_males|_total|_preprimary_ece|_primary|_secondary"),
indicator = ifelse(indicator == "out_of_school", "out_of_school_children", indicator),
value = as.numeric(value)),
read_xlsx("./data/county_profiles_raw.xlsx",
sheet = i, skip = 7) %>%
slice(1:3) %>%
clean_names() %>%
rename(indicator = child_protection_indicator_4,
value = percentage) %>%
select(where(not_all_na)) %>%
mutate(sex_modifier = "female",
age_modifier = "total",
indicator = str_replace_all(indicator, "Isolo", "Isiolo"),
indicator = str_remove(indicator,
paste0(" in ", county_name, " County")),
indicator = str_remove(indicator,
paste0(" in ", county_name, " county")),
value = as.numeric(value))
) %>%
mutate(county = ifelse(str_detect(indicator, "Kenya|national"),
"national",
paste0(county_name)))
}
county_clean <- bind_rows(
read_table(1),
read_table(2),
read_table(3),
read_table(4),
read_table(5),
read_table(6),
read_table(7),
read_table(8),
read_table(9),
read_table(10),
read_table(11),
read_table(12),
read_table(13),
read_table(14)
) %>%
distinct(indicator, value, sex_modifier, age_modifier, county)
county_name_national_averages <- (read_xlsx("./data/county_profiles_raw.xlsx",
sheet = 1) %>%
names())[1] %>%
{str_replace_all(., " County- Education Profile", "")}
national_averages <- read_xlsx("./data/county_profiles_raw.xlsx",
sheet = 1, skip = 14) %>%
slice(1:26) %>%
setNames(
c("indicator",
"preprimary_ece_female",
"preprimary_ece_male",
"preprimary_ece_total",
"primary_female",
"primary_male",
"primary_total",
"secondary_female",
"secondary_male",
"secondary_total",
"national_average")
) %>%
select(indicator, national_average) %>%
fill(indicator) %>%
naniar::replace_with_na(list(national_average = "NA")) %>%
filter(!is.na(national_average)) %>%
mutate_at(vars(indicator), ~ str_trim(str_squish(.))) %>%
mutate_at(vars(indicator),
~ gsub("\\[.*?\\]", "", .)) %>%
mutate(national_average = str_replace_all(national_average, "\\(|\\)", "")) %>%
mutate(value_temp = national_average) %>%
separate_rows(national_average, sep = ",") %>%
filter(national_average != "") %>%
mutate(age_modifier = case_when(str_detect(national_average, "PP") ~ "preprimary_ece",
str_detect(national_average, "P") ~ "primary",
str_detect(national_average, "S:|S.:") ~ "secondary",
str_detect(indicator, "Transition Rate") ~ "secondary",
TRUE ~ NA_character_),
sex_modifier = case_when(str_detect(national_average, "B:") ~ "male",
str_detect(national_average, "G:") ~ "female",
str_detect(national_average, "T:") ~ "total",
TRUE ~ NA_character_)) %>%
mutate(value_temp = str_sub(str_remove_all(value_temp, ","), start = 5L),
value = case_when(indicator == "Number of education Institutions (Public & Private)" &
!is.na(age_modifier) ~ parse_number(value_temp),
national_average == "PP.: B: 111.5" ~ 111.5,
national_average == "PP.: B: 40" ~ 40,
TRUE ~ parse_number(national_average))) %>%
filter(value %out% c(652, 464, 390)) %>%
fill(age_modifier) %>%
select(-national_average, -value_temp) %>%
rbind(
read_xlsx("./data/county_profiles_raw.xlsx",
sheet = 1, skip = 7) %>%
slice(4) %>%
clean_names() %>%
rename(indicator = child_protection_indicator_4,
value = percentage) %>%
select(where(not_all_na)) %>%
mutate(sex_modifier = "female",
age_modifier = "total",
indicator = str_remove(indicator,
paste0(" in ", county_name_national_averages, " County")),
value = as.numeric(value))
) %>%
mutate(county = "national")
counties <- rbind(national_averages, county_clean)
counties %>%
write_csv("./data/counties.csv")
locations <- read_xlsx("./data/ken_adminboundaries_tabulardata.xlsx",
sheet = "ADM1") %>%
clean_names()
pcode1_shape <-
sf::st_read("./data/ken_adm_iebc_20191031_shp/ken_admbnda_adm1_iebc_20191031.shp",
quiet = TRUE) %>%
clean_names()
pre_enrol <- read_csv("./data/table_export_a.csv") %>%
clean_names() %>%
filter(county != "National") %>%
mutate(county = recode(county,
"Elgeyo Marakwet" = "Elgeyo-Marakwet",
"Tharaka Nithi" = "Tharaka-Nithi",
"Nairobi City" = "Nairobi")) %>%
left_join(locations %>% select(county = adm1_en,
adm1_pcode))
oos <- read_excel("./data/DataAnnexTables_OOSCI_KenyaFinal_2021.09.10.xlsx",
sheet = "OUTOFSCHOOLNUMBERSALLLEVLS",
skip = 2) %>%
janitor::clean_names() %>%
rename(males_out_of_school_4_5_years = number_of_out_of_school_children_4_to_5_years_2,
males_out_of_school_6_13_years = number_of_out_of_school_children_6_to_13_years_3,
males_out_of_school_14_17_years = number_of_out_of_school_adolescents_14_to_17_years_4,
county = males,
females_out_of_school_4_5_years = number_of_out_of_school_children_4_to_5_years_7,
females_out_of_school_6_13_years = number_of_out_of_school_children_6_to_13_years_8,
females_out_of_school_14_17_years = number_of_out_of_school_adolescents_14_to_17_years_9,
admin_area = females) %>%
mutate(female_total = females_out_of_school_4_5_years + females_out_of_school_6_13_years +
females_out_of_school_14_17_years,
male_total = males_out_of_school_4_5_years + males_out_of_school_6_13_years +
males_out_of_school_14_17_years,
oos_total = female_total + male_total)
counties <- read_csv("./data/counties.csv") %>%
mutate(sex_modifier = fct_relevel(sex_modifier, c("male", "female", "total")),
county = recode(county, "national" = "National"))
counties %>% count(indicator)
counties %>% filter(indicator == "Students' dropout/Absenteeism during 2022")
counties %>%
filter(county %in% c(county_selection)) %>%
filter(indicator == "Students' dropout/Absenteeism during 2022")
counties %>% count(indicator)
