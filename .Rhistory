counties %>%
filter(county == county_selection) %>%
filter(indicator == "county_population" & sex_modifier != "total") %>%
pie_chart() +
labs(title = "County population[1]",
subtitle = paste0(counties %>%
filter(indicator == "county_population" &
sex_modifier == "total" &
age_modifier == "total") %>%
pull(value) %>%
format(big.mark = ","))) +
counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "school_age_children") &
sex_modifier != "total") %>%
pie_chart() +
labs(title = "School-aged children \n        (4-17 years)[2]",
subtitle = paste0(counties %>%
filter(indicator == "school_age_children" &
sex_modifier == "total" &
age_modifier == "total") %>%
pull(value) %>%
format(big.mark = ","))) +
counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
age_modifier == "preprimary_ece" &
sex_modifier != "total") %>%
pie_chart() +
labs(title = "Out-of-school \n        Preprimary/ECE (4-5) years[3]",
subtitle = paste0(counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
sex_modifier == "total" &
age_modifier == "preprimary_ece") %>%
pull(value) %>%
format(big.mark = ","))) +
theme(plot.title = element_text(hjust = .25),
plot.subtitle = element_text(hjust = .25)) +
counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
age_modifier == "primary" &
sex_modifier != "total") %>%
pie_chart() +
labs(title = "Out-of-school \n     Primary (6-13) years[3]",
subtitle = paste0(counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
sex_modifier == "total" &
age_modifier == "primary") %>%
pull(value) %>%
format(big.mark = ","))) +
theme(plot.title = element_text(hjust = .25),
plot.subtitle = element_text(hjust = .25)) +
counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
age_modifier == "secondary" &
sex_modifier != "total") %>%
pie_chart() +
labs(title = "Out-of-school \n     Secondary (14-17) years[3]",
subtitle = paste0(counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
sex_modifier == "total" &
age_modifier == "secondary") %>%
pull(value) %>%
format(big.mark = ","))) +
theme(plot.title = element_text(hjust = .2),
plot.subtitle = element_text(hjust = .2)) +
counties %>%
filter(county %in% c(county_selection, "National")) %>%
filter(str_detect(indicator, "GBV|FGM|Pregnancy")) %>%
arrange(indicator) %>%
mutate(indicator = str_wrap(indicator, width = 50)) %>%
mutate(indicator = fct_relevel(indicator,
c("GBV: Percentage of girls/women who have\nexperienced physical violence since age 15",
"FGM: Percentage of women aged 15-49 yrs who were\never circumcised across Kenya",
"Percentage of Teenage Pregnancy for girls/women\naged 15-19 yrs who have ever been pregnant",
"GBV: Percentage of girls/women aged 15-49 yrs who\nhave ever experienced sexual violence"))) %>%
ggplot(aes(x = value,
y = fct_rev(indicator))) +
geom_col(fill = "#2b54ad", width = .5) +
scale_x_continuous(labels = percent) +
geom_text(aes(label = percent(value, accuracy = .1)),
hjust = 1,
colour = "white") +
theme(panel.background = element_rect("#f4f4f4"),
axis.text.y = element_text(size = 7)) +
labs(title = bquote("Child Protection Indicator[2]"),
y = "", x = "") +
plot_layout(nrow = 1, widths = c(1, 1, 1, 1, 1, 2)) +
plot_annotation(title = "Key figures for the county") &
theme(text = element_text(size = 20))
(counties %>%
mutate(indicator = str_replace_all(indicator, "education Institutions", "Education Institutions")) %>%
filter(county %in% c(county_selection)) %>%
filter(str_detect(indicator, "Number of Education Institutions")) %>%
mutate(age_modifier = str_to_title(age_modifier),
age_modifier = str_replace_all(age_modifier, "Preprimary_ece", "Pre-primary\n/ECE")) %>%
mutate(age_modifier = fct_relevel(age_modifier, c("Secondary",
"Primary",
"Pre-primary\n/ECE"))) %>%
ggplot(aes(x = value, y = age_modifier)) +
geom_col(fill = "#2b54ad", width = .5) +
geom_text(aes(label = value),
hjust = 1,
colour = "white") +
theme(panel.background = element_rect("#f4f4f4")) +
labs(subtitle = "Education Institutions",
title = "Education Indicators",
y = "", x = "Number of institutions") +
counties %>%
filter(county %in% c(county_selection, "National")) %>%
filter(str_detect(indicator, "Gender Parity")) %>%
make_dodged_plot() +
labs(subtitle = "Gender Parity Index",
y = "", x = "Gender parity index", fill = "")) /
(counties %>%
filter(county %in% c(county_selection)) %>%
filter(indicator == "Students' dropout/Absenteeism during 2022" & sex_modifier != "total") %>%
mutate(age_modifier = str_to_title(age_modifier),
age_modifier = str_replace_all(age_modifier, "Preprimary_ece", "Pre-primary\n/ECE")) %>%
mutate(age_modifier = fct_relevel(age_modifier, c("Secondary",
"Primary",
"Pre-primary\n/ECE"))) %>%
ggplot(aes(x = value, y = age_modifier, fill = sex_modifier)) +
geom_col(position = position_dodge()) +
geom_text(aes(label = value), position = position_dodge(width = .9),
hjust = -1, colour = "white", size = 3) +
scale_fill_manual(values = c("#002021", "#19686a")) +
theme(legend.position = "top",
axis.text.y = element_text(size = 10),
panel.background = element_rect("#f4f4f4"),
legend.text = element_text(size = 3),
plot.title = element_text(size = 12)) +
guides(fill = guide_legend(override.aes = list(size = 0.3))) +
labs(subtitle = "Dropouts/Absenteeism in 2022",
x = "Number of children", y = "",
fill =  "Sex") +
counties %>%
filter(county %in% c(county_selection, "National")) %>%
filter(str_detect(indicator, "Net Enrolment") & sex_modifier == "total") %>%
make_dodged_plot() +
labs(subtitle = "Net Enrolment Rate 2020 [8]",
y = "", x = "Net enrolment rate", fill = ""))
pcode1_shape %>%
st_as_sf() %>%
mutate(is_county = ifelse(adm1_en == county_selection,
county_selection,
"Other counties")) %>%
ggplot() +
geom_sf(size = .1, colour = "grey70",
aes(fill = is_county)) +
geom_sf_text(aes(label = adm1_en),
size = 3,
check_overlap = TRUE,
colour = "grey20") +
theme_void() +
scale_fill_manual(values = c("#ed6b24", "grey")) +
theme(legend.position = "none") +
counties %>%
filter(county %in% c(county_selection, "National")) %>%
filter(str_detect(indicator, "GBV|FGM|Pregnancy")) %>%
arrange(indicator) %>%
mutate(indicator = str_wrap(indicator, width = 50)) %>%
mutate(indicator = fct_relevel(indicator,
c("GBV: Percentage of girls/women who have\nexperienced physical violence since age 15",
"FGM: Percentage of women aged 15-49 yrs who were\never circumcised across Kenya",
"Percentage of Teenage Pregnancy for girls/women\naged 15-19 yrs who have ever been pregnant",
"GBV: Percentage of girls/women aged 15-49 yrs who\nhave ever experienced sexual violence"))) %>%
ggplot(aes(x = value,
y = fct_rev(indicator))) +
geom_col(fill = "#2b54ad", width = .5) +
scale_x_continuous(labels = percent) +
geom_text(aes(label = percent(value, accuracy = .1)),
hjust = 1,
colour = "white") +
theme(panel.background = element_rect("#f4f4f4"),
axis.text.y = element_text(size = 7)) +
labs(title = bquote("Child Protection Indicator[2]"),
y = "", x = "") +
plot_layout(ncol = 1, heights = c(1, 2.5))
counties %>%
filter(county %in% c(county_selection, "National")) %>%
filter(str_detect(indicator, "GBV|FGM|Pregnancy")) %>%
arrange(indicator) %>%
mutate(indicator = str_wrap(indicator, width = 30))
labs(x = expression(paste("x axis ", ring(A)^2)), y = "y axis")
counties %>%
filter(county == county_selection) %>%
filter(indicator == "county_population" & sex_modifier != "total") %>%
pie_chart() +
labs(title = expression(paste("County populatio", n^2)),
subtitle = paste0(counties %>%
filter(indicator == "county_population" &
sex_modifier == "total" &
age_modifier == "total") %>%
pull(value) %>%
format(big.mark = ","))) +
plot_spacer() +
counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "school_age_children") &
sex_modifier != "total") %>%
pie_chart() +
labs(title = "School-aged children (4-17 years)[2]",
subtitle = paste0(counties %>%
filter(indicator == "school_age_children" &
sex_modifier == "total" &
age_modifier == "total") %>%
pull(value) %>%
format(big.mark = ","))) +
plot_spacer() +
counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
age_modifier == "preprimary_ece" &
sex_modifier != "total") %>%
pie_chart() +
labs(title = "Out-of-school \n        Preprimary/ECE (4-5) years[3]",
subtitle = paste0(counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
sex_modifier == "total" &
age_modifier == "preprimary_ece") %>%
pull(value) %>%
format(big.mark = ","))) +
theme(plot.title = element_text(hjust = .25),
plot.subtitle = element_text(hjust = .25)) +
plot_spacer() +
counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
age_modifier == "primary" &
sex_modifier != "total") %>%
pie_chart() +
labs(title = "Out-of-school \n     Primary (6-13) years[3]",
subtitle = paste0(counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
sex_modifier == "total" &
age_modifier == "primary") %>%
pull(value) %>%
format(big.mark = ","))) +
theme(plot.title = element_text(hjust = .25),
plot.subtitle = element_text(hjust = .25)) +
plot_spacer() +
counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
age_modifier == "secondary" &
sex_modifier != "total") %>%
pie_chart() +
labs(title = "Out-of-school \n     Secondary (14-17) years[3]",
subtitle = paste0(counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
sex_modifier == "total" &
age_modifier == "secondary") %>%
pull(value) %>%
format(big.mark = ","))) +
theme(plot.title = element_text(hjust = .2),
plot.subtitle = element_text(hjust = .2)) +
plot_layout(nrow = 1)
counties %>%
filter(county == county_selection) %>%
filter(indicator == "county_population" & sex_modifier != "total") %>%
pie_chart() +
labs(title = expression(paste("County populatio", n^2)),
subtitle = paste0(counties %>%
filter(indicator == "county_population" &
sex_modifier == "total" &
age_modifier == "total") %>%
pull(value) %>%
format(big.mark = ","))) +
plot_spacer() +
counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "school_age_children") &
sex_modifier != "total") %>%
pie_chart() +
labs(title = "School-aged children (4-17 years)[2]",
subtitle = paste0(counties %>%
filter(indicator == "school_age_children" &
sex_modifier == "total" &
age_modifier == "total") %>%
pull(value) %>%
format(big.mark = ","))) +
plot_spacer() +
counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
age_modifier == "preprimary_ece" &
sex_modifier != "total") %>%
pie_chart() +
labs(title = "Out-of-school \n        Preprimary/ECE (4-5) years[3]",
subtitle = paste0(counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
sex_modifier == "total" &
age_modifier == "preprimary_ece") %>%
pull(value) %>%
format(big.mark = ","))) +
theme(plot.title = element_text(hjust = .25),
plot.subtitle = element_text(hjust = .25)) +
plot_spacer() +
counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
age_modifier == "primary" &
sex_modifier != "total") %>%
pie_chart() +
labs(title = "Out-of-school \n     Primary (6-13) years[3]",
subtitle = paste0(counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
sex_modifier == "total" &
age_modifier == "primary") %>%
pull(value) %>%
format(big.mark = ","))) +
theme(plot.title = element_text(hjust = .25),
plot.subtitle = element_text(hjust = .25)) +
plot_spacer() +
counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
age_modifier == "secondary" &
sex_modifier != "total") %>%
pie_chart() +
labs(title = "Out-of-school \n     Secondary (14-17) years[3]",
subtitle = paste0(counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
sex_modifier == "total" &
age_modifier == "secondary") %>%
pull(value) %>%
format(big.mark = ","))) +
theme(plot.title = element_text(hjust = .2),
plot.subtitle = element_text(hjust = .2)) +
plot_layout(nrow = 1)
counties %>%
filter(county == county_selection) %>%
filter(indicator == "county_population" & sex_modifier != "total") %>%
pie_chart() +
labs(title = expression(paste("County populatio", n^1)),
subtitle = paste0(counties %>%
filter(indicator == "county_population" &
sex_modifier == "total" &
age_modifier == "total") %>%
pull(value) %>%
format(big.mark = ","))) +
plot_spacer() +
counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "school_age_children") &
sex_modifier != "total") %>%
pie_chart() +
labs(title = expression(paste("School-aged children (4-17 years", )^2)),
counties %>%
filter(county == county_selection) %>%
filter(indicator == "county_population" & sex_modifier != "total") %>%
pie_chart() +
labs(title = expression(paste("County populatio", n^1)),
subtitle = paste0(counties %>%
filter(indicator == "county_population" &
sex_modifier == "total" &
age_modifier == "total") %>%
pull(value) %>%
format(big.mark = ","))) +
plot_spacer() +
counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "school_age_children") &
sex_modifier != "total") %>%
pie_chart() +
labs(title = expression(paste("School-aged children (4-17 years", ")"^2)),
subtitle = paste0(counties %>%
filter(indicator == "school_age_children" &
sex_modifier == "total" &
age_modifier == "total") %>%
pull(value) %>%
format(big.mark = ","))) +
plot_spacer() +
counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
age_modifier == "preprimary_ece" &
sex_modifier != "total") %>%
pie_chart() +
labs(title = "Out-of-school \n        Preprimary/ECE (4-5) years[3]",
subtitle = paste0(counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
sex_modifier == "total" &
age_modifier == "preprimary_ece") %>%
pull(value) %>%
format(big.mark = ","))) +
theme(plot.title = element_text(hjust = .25),
plot.subtitle = element_text(hjust = .25)) +
plot_spacer() +
counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
age_modifier == "primary" &
sex_modifier != "total") %>%
pie_chart() +
labs(title = "Out-of-school \n     Primary (6-13) years[3]",
subtitle = paste0(counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
sex_modifier == "total" &
age_modifier == "primary") %>%
pull(value) %>%
format(big.mark = ","))) +
theme(plot.title = element_text(hjust = .25),
plot.subtitle = element_text(hjust = .25)) +
plot_spacer() +
counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
age_modifier == "secondary" &
sex_modifier != "total") %>%
pie_chart() +
labs(title = "Out-of-school \n     Secondary (14-17) years[3]",
subtitle = paste0(counties %>%
filter(county == county_selection) %>%
filter(str_detect(indicator, "out_of_school_children") &
sex_modifier == "total" &
age_modifier == "secondary") %>%
pull(value) %>%
format(big.mark = ","))) +
theme(plot.title = element_text(hjust = .2),
plot.subtitle = element_text(hjust = .2)) +
plot_layout(nrow = 1)
gridExtra::tableGrob(counties %>%
filter(county %in% c(county_selection, "national")) %>%
filter(str_detect(indicator, "improved water source") | str_detect(indicator, "no water source"))  %>%
select(indicator, value) %>%
select_all(~ str_to_title(.)) %>%
rename(`Water in schools` = Indicator,
` ` = Value)
)
counties %>%
filter(county %in% c(county_selection, "National")) %>%
filter(str_detect(indicator, "Learner to teacher")) %>%
group_by(age_modifier, county) %>%
summarise(value = sum(value, na.rm = TRUE), .groups = "drop") %>%
make_dodged_plot() +
labs(x = "", y = "",
title = "Learner-to-Teacher Ratio",
fill = "") +
counties %>%
filter(county %in% c(county_selection, "National")) %>%
filter(str_detect(indicator, "Classroom")) %>%
make_dodged_plot() +
labs(x = "", y = "",
title = "Learner-to-Classroom Ratio",
fill = "") +
counties %>%
filter(county %in% c(county_selection, "National")) %>%
filter(str_detect(indicator, "Learner to Toilet")) %>%
group_by(age_modifier, county) %>%
summarise(value = sum(value, na.rm = TRUE),
.groups = "drop") %>%
make_dodged_plot() +
labs(x = "", y = "",
title = "Learner-to-Toilet Ratio",
fill = "") +
gridExtra::tableGrob(counties %>%
filter(county %in% c(county_selection, "national")) %>%
filter(str_detect(indicator, "improved water source") | str_detect(indicator, "no water source"))  %>%
select(indicator, value) %>%
select_all(~ str_to_title(.)) %>%
rename(`Water in schools` = Indicator,
` ` = Value))
counties %>%
filter(county %in% c(county_selection, "National")) %>%
filter(str_detect(indicator, "Learner to teacher")) %>%
group_by(age_modifier, county) %>%
summarise(value = sum(value, na.rm = TRUE), .groups = "drop") %>%
make_dodged_plot() +
labs(x = "", y = "",
title = "Learner-to-Teacher Ratio",
fill = "") +
counties %>%
filter(county %in% c(county_selection, "National")) %>%
filter(str_detect(indicator, "Classroom")) %>%
make_dodged_plot() +
labs(x = "", y = "",
title = "Learner-to-Classroom Ratio",
fill = "") +
counties %>%
filter(county %in% c(county_selection, "National")) %>%
filter(str_detect(indicator, "Learner to Toilet")) %>%
group_by(age_modifier, county) %>%
summarise(value = sum(value, na.rm = TRUE),
.groups = "drop") %>%
make_dodged_plot() +
labs(x = "", y = "",
title = "Learner-to-Toilet Ratio",
fill = "") +
gridExtra::tableGrob(
counties %>%
filter(county %in% c(county_selection, "national")) %>%
filter(str_detect(indicator, "improved water source") | str_detect(indicator, "no water source"))  %>%
select(indicator, value) %>%
mutate(indicator = str_wrap(indicator, 30)) %>%
select_all(~ str_to_title(.)) %>%
rename(`Water in schools` = Indicator,
` ` = Value))
