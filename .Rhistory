names_to = "type",
values_to = "learner_toilet_ratio") %>%
mutate(grade = "preprimary",
sex_modifier = ifelse(str_detect(type, "boys"), "boys", "girls"),
public_private = ifelse(str_detect(type, "public"), "public", "private")) %>%
select(county, grade, sex_modifier, learner_toilet_ratio, public_private),
read_excel("./data/ocr_tables/pupil_toilet_ratio_primary.xlsx") %>%
setNames(c("county",
"learner_toilet_ratio_boys_public",
"learner_toilet_ratio_girls_public",
"learner_toilet_ratio_boys_private",
"learner_toilet_ratio_girls_private")) %>%
pivot_longer(cols = -county,
names_to = "type",
values_to = "learner_toilet_ratio") %>%
mutate(grade = "primary",
sex_modifier = ifelse(str_detect(type, "boys"), "boys", "girls"),
public_private = ifelse(str_detect(type, "public"), "public", "private")) %>%
select(county, grade, sex_modifier, learner_toilet_ratio, public_private),
read_excel("./data/ocr_tables/pupil_toilet_ratio_secondary.xlsx") %>%
clean_names() %>%
select(-toilets_boys_public, -toilets_girls_public,
-toilets_boys_private, -toilets_girls_private) %>%
pivot_longer(cols = -county,
names_to = "type",
values_to = "learner_toilet_ratio") %>%
mutate(grade = "secondary",
sex_modifier = ifelse(str_detect(type, "boys"), "boys", "girls"),
public_private = ifelse(str_detect(type, "public"), "public", "private")) %>%
select(county, grade, sex_modifier, learner_toilet_ratio, public_private)
) %>%
rename(age_modifier = grade)
learner_toilet_ratio %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier"))
learner_toilet_ratio %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
mutate(toilets = enrolment / learner_toilet_ratio)
enrolment %>% filter(county == "Wajir")
public_enrolment
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
mutate(toilets = enrolment / learner_toilet_ratio)
enrolment %>% filter(county == "Siaya")
enrolment %>% filter(county == "Siaya") %>%
filter(public_private == "public" & !str_detect(grade, "total")) %>%
group_by(county, sex_modifier, age_modifier) %>%
summarise(enrolment = sum(enrolment))
learner_toilet_ratio %>% count(county)
enrolments %>% count(county)
enrolment %>% count(county)
enrolment %>%
mutate(county = case_when(county == "Kaiiado" ~ "Kajiado",
TRUE ~ county)) %>%
count(county)
learner_toilet_ratio %>%
mutate(county = case_when(county == "Kish" ~ "Kisii"),
TRUE ~ county) %>%
count(county)
TRUE ~ county) %>%
learner_toilet_ratio %>%
mutate(county = case_when(county == "Kish" ~ "Kisii",
TRUE ~ county)) %>%
count(county)
enrolment %>%
mutate(county = case_when(county == "Kaiiado" ~ "Kajiado",
county == "Nairobi Citv" ~ "Nairobi City",
county == "Nvamira" ~ "Nyamira",
county == "Siava" ~ "Siaya",
county == "Waiir" ~ "Wajir",
TRUE ~ county)) %>%
count(county)
enrolment <- rbind(
# Preprimary enrolments
read_excel("./data/ocr_tables/enrolment_public_preprimary.xlsx") %>%
clean_names() %>%
pivot_longer(cols = pp1_boys:total,
names_to = "grade",
values_to = "enrolment") %>%
mutate(sex_modifier = case_when(str_detect(grade, "boys") ~ "boys",
str_detect(grade, "girls") ~ "girls",
str_detect(grade, "total") ~ "total"),
age_modifier = "preprimary",
public_private = "public") %>%
mutate(grade = str_replace_all(grade, "pp", "preprimary"),
grade = recode(grade,
"total_boys" = "preprimary_total_boys",
"total_girls" = "preprimary_total_girls",
"total" = "preprimary_total")),
read_excel("./data/ocr_tables/enrolment_private_preprimary.xlsx") %>%
setNames(c("county", "pp1_boys", "pp1_girls", "pp1_total",
"pp2_boys", "pp2_girls", "pp2_total",
"total_boys", "total_girls", "total")) %>%
slice(2:48) %>%
pivot_longer(cols = pp1_boys:total,
names_to = "grade",
values_to = "enrolment") %>%
mutate(sex_modifier = case_when(str_detect(grade, "boys") ~ "boys",
str_detect(grade, "girls") ~ "girls",
str_detect(grade, "total") ~ "total"),
age_modifier = "preprimary",
public_private = "private") %>%
mutate(grade = str_replace_all(grade, "pp", "preprimary"),
grade = recode(grade,
"total_boys" = "preprimary_total_boys",
"total_girls" = "preprimary_total_girls",
"total" = "preprimary_total")),
# Primary enrolments
read_excel("./data/ocr_tables/enrolment_boys_grade1_6_public_primary_schools.xlsx") %>%
primary_enrolments() %>%
mutate(public_private = "public",
sex_modifier = "boys",
sex_modifier = ifelse(str_detect(grade, "primary_total"), "total", sex_modifier),
grade = paste0(grade, "_", sex_modifier)),
read_excel("./data/ocr_tables/enrolment_girls_grade1_6_public_primary_schools.xlsx") %>%
primary_enrolments() %>%
mutate(public_private = "public",
sex_modifier = "girls",
sex_modifier = ifelse(str_detect(grade, "primary_total"), "total", sex_modifier),
grade = paste0(grade, "_", sex_modifier)),
read_excel("./data/ocr_tables/enrolment_boys_grade1_6_private_primary_schools.xlsx") %>%
primary_enrolments() %>%
mutate(public_private = "private",
sex_modifier = "boys",
sex_modifier = ifelse(str_detect(grade, "primary_total"), "total", sex_modifier),
grade = paste0(grade, "_", sex_modifier)),
read_excel("./data/ocr_tables/enrolment_girls_grade1_6_private_primary_schools.xlsx") %>%
primary_enrolments() %>%
mutate(public_private = "private",
sex_modifier = "girls",
sex_modifier = ifelse(str_detect(grade, "primary_total"), "total", sex_modifier),
grade = paste0(grade, "_", sex_modifier)),
# Lower secondary enrolments
read_excel("./data/ocr_tables/enrolment_grade_7_8_public_lower_secondary.xlsx") %>%
setNames(lower_secondary_names) %>%
slice(2:49) %>%
pivot_longer(cols = grade_7_boys:lower_secondary_total,
names_to = "grade",
values_to = "enrolment") %>%
mutate(public_private = "public",
age_modifier = "primary",
sex_modifier = case_when(str_detect(grade, "boys") ~ "boys",
str_detect(grade, "girls") ~ "girls",
str_detect(grade, "total") ~ "total")),
read_excel("./data/ocr_tables/enrolment_grade_7_8_private_lower_secondary.xlsx") %>%
setNames(lower_secondary_names) %>%
slice(2:49) %>%
pivot_longer(cols = grade_7_boys:lower_secondary_total,
names_to = "grade",
values_to = "enrolment") %>%
mutate(public_private = "private",
age_modifier = "primary",
sex_modifier = case_when(str_detect(grade, "boys") ~ "boys",
str_detect(grade, "girls") ~ "girls",
str_detect(grade, "total") ~ "total")),
# Secondary enrolments
read_excel("./data/ocr_tables/enrolment_public_secondary.xlsx") %>%
clean_names() %>%
pivot_longer(cols = form_1_boys:total,
names_to = "grade",
values_to = "enrolment") %>%
mutate(grade = str_replace_all(grade, "form_", "form"),
age_modifier = "secondary",
sex_modifier = case_when(str_detect(grade, "total") ~ "total",
str_detect(grade, "boys") ~ "boys",
str_detect(grade, "girls") ~ "girls"),
public_private = "public",
grade = ifelse(str_detect(grade, "total") & !str_detect(grade, "_"),
"secondary_total",
grade)),
read_excel("./data/ocr_tables/enrolment_private_secondary.xlsx") %>%
clean_names() %>%
pivot_longer(cols = form_1_boys:total,
names_to = "grade",
values_to = "enrolment") %>%
mutate(grade = str_replace_all(grade, "form_", "form"),
age_modifier = "secondary",
sex_modifier = case_when(str_detect(grade, "total") ~ "total",
str_detect(grade, "boys") ~ "boys",
str_detect(grade, "girls") ~ "girls"),
public_private = "private",
grade = ifelse(str_detect(grade, "total") & !str_detect(grade, "_"),
"secondary_total",
grade))
) %>%
mutate(enrolment = as.numeric(enrolment)) %>%
mutate(county = case_when(county == "Kaiiado" ~ "Kajiado",
county == "Nairobi Citv" ~ "Nairobi City",
county == "Nvamira" ~ "Nyamira",
county == "Siava" ~ "Siaya",
county == "Waiir" ~ "Wajir",
TRUE ~ county))
public_enrolment <- enrolment %>%
filter(public_private == "public" & !str_detect(grade, "total")) %>%
group_by(county, sex_modifier, age_modifier) %>%
summarise(enrolment = sum(enrolment))
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
mutate(toilets = enrolment / learner_toilet_ratio)
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
filter(!is.na(enrolment))
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
filter(is.na(enrolment))
learner_toilet_ratio <- rbind(
read_excel("./data/ocr_tables/learner_toilet_ratios_preprimary.xlsx") %>%
setNames(c("county",
"learner_toilet_ratio_boys_public",
"learner_toilet_ratio_girls_public",
"learner_toilet_ratio_boys_private",
"learner_toilet_ratio_girls_private")) %>%
pivot_longer(cols = -county,
names_to = "type",
values_to = "learner_toilet_ratio") %>%
mutate(grade = "preprimary",
sex_modifier = ifelse(str_detect(type, "boys"), "boys", "girls"),
public_private = ifelse(str_detect(type, "public"), "public", "private")) %>%
select(county, grade, sex_modifier, learner_toilet_ratio, public_private),
read_excel("./data/ocr_tables/pupil_toilet_ratio_primary.xlsx") %>%
setNames(c("county",
"learner_toilet_ratio_boys_public",
"learner_toilet_ratio_girls_public",
"learner_toilet_ratio_boys_private",
"learner_toilet_ratio_girls_private")) %>%
pivot_longer(cols = -county,
names_to = "type",
values_to = "learner_toilet_ratio") %>%
mutate(grade = "primary",
sex_modifier = ifelse(str_detect(type, "boys"), "boys", "girls"),
public_private = ifelse(str_detect(type, "public"), "public", "private")) %>%
select(county, grade, sex_modifier, learner_toilet_ratio, public_private),
read_excel("./data/ocr_tables/pupil_toilet_ratio_secondary.xlsx") %>%
clean_names() %>%
select(-toilets_boys_public, -toilets_girls_public,
-toilets_boys_private, -toilets_girls_private) %>%
pivot_longer(cols = -county,
names_to = "type",
values_to = "learner_toilet_ratio") %>%
mutate(grade = "secondary",
sex_modifier = ifelse(str_detect(type, "boys"), "boys", "girls"),
public_private = ifelse(str_detect(type, "public"), "public", "private")) %>%
select(county, grade, sex_modifier, learner_toilet_ratio, public_private)
) %>%
rename(age_modifier = grade) %>%
mutate(county = case_when(county == "Kish" ~ "Kisii",
TRUE ~ county))
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
filter(is.na(enrolment))
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
mutate(toilets = enrolment / learner_toilet_ratio)
counties %>% filter(str_detect(indicator, "Toilet"))
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
mutate(toilets = (enrolment / learner_toilet_ratio)) %>%
group_by(county, age_modifer) %>%
summarise(enrolment = sum(enrolment),
toilets = sum(toilets))
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
mutate(toilets = (enrolment / learner_toilet_ratio)) %>%
group_by(county, age_modificer) %>%
summarise(enrolment = sum(enrolment),
toilets = sum(toilets))
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
mutate(toilets = (enrolment / learner_toilet_ratio)) %>%
group_by(county, age_modifier) %>%
summarise(enrolment = sum(enrolment),
toilets = sum(toilets))
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
mutate(toilets = (enrolment / learner_toilet_ratio)) %>%
group_by(county, age_modifier) %>%
summarise(enrolment = sum(enrolment),
toilets = sum(toilets)) %>%
mutate(learner_toilet_ratio = enrolment / toilets)
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
mutate(toilets = (enrolment / learner_toilet_ratio))
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
mutate(toilets = (enrolment / learner_toilet_ratio)) %>%
select(county, age_modifier, sex_modifier, enrolment, toilets, learner_toilet_ratio)
rbind(
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
mutate(toilets = (enrolment / learner_toilet_ratio)) %>%
group_by(county, age_modifier) %>%
summarise(enrolment = sum(enrolment),
toilets = sum(toilets)) %>%
mutate(learner_toilet_ratio = enrolment / toilets,
sex_modifier = "total"),
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
mutate(toilets = (enrolment / learner_toilet_ratio)) %>%
select(county, age_modifier, sex_modifier, enrolment, toilets, learner_toilet_ratio))
learner_toilet_ratio <- rbind(
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
mutate(toilets = (enrolment / learner_toilet_ratio)) %>%
group_by(county, age_modifier) %>%
summarise(enrolment = sum(enrolment),
toilets = sum(toilets)) %>%
mutate(learner_toilet_ratio = enrolment / toilets,
sex_modifier = "total"),
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
mutate(toilets = (enrolment / learner_toilet_ratio)) %>%
select(county, age_modifier, sex_modifier, enrolment, toilets, learner_toilet_ratio))
learner_toilet_ratio_recalculated <- rbind(
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
mutate(toilets = (enrolment / learner_toilet_ratio)) %>%
group_by(county, age_modifier) %>%
summarise(enrolment = sum(enrolment),
toilets = sum(toilets)) %>%
mutate(learner_toilet_ratio = enrolment / toilets,
sex_modifier = "total"),
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
mutate(toilets = (enrolment / learner_toilet_ratio)) %>%
select(county, age_modifier, sex_modifier, enrolment, toilets, learner_toilet_ratio))
learner_toilet_ratio <- rbind(
read_excel("./data/ocr_tables/learner_toilet_ratios_preprimary.xlsx") %>%
setNames(c("county",
"learner_toilet_ratio_boys_public",
"learner_toilet_ratio_girls_public",
"learner_toilet_ratio_boys_private",
"learner_toilet_ratio_girls_private")) %>%
pivot_longer(cols = -county,
names_to = "type",
values_to = "learner_toilet_ratio") %>%
mutate(grade = "preprimary",
sex_modifier = ifelse(str_detect(type, "boys"), "boys", "girls"),
public_private = ifelse(str_detect(type, "public"), "public", "private")) %>%
select(county, grade, sex_modifier, learner_toilet_ratio, public_private),
read_excel("./data/ocr_tables/pupil_toilet_ratio_primary.xlsx") %>%
setNames(c("county",
"learner_toilet_ratio_boys_public",
"learner_toilet_ratio_girls_public",
"learner_toilet_ratio_boys_private",
"learner_toilet_ratio_girls_private")) %>%
pivot_longer(cols = -county,
names_to = "type",
values_to = "learner_toilet_ratio") %>%
mutate(grade = "primary",
sex_modifier = ifelse(str_detect(type, "boys"), "boys", "girls"),
public_private = ifelse(str_detect(type, "public"), "public", "private")) %>%
select(county, grade, sex_modifier, learner_toilet_ratio, public_private),
read_excel("./data/ocr_tables/pupil_toilet_ratio_secondary.xlsx") %>%
clean_names() %>%
select(-toilets_boys_public, -toilets_girls_public,
-toilets_boys_private, -toilets_girls_private) %>%
pivot_longer(cols = -county,
names_to = "type",
values_to = "learner_toilet_ratio") %>%
mutate(grade = "secondary",
sex_modifier = ifelse(str_detect(type, "boys"), "boys", "girls"),
public_private = ifelse(str_detect(type, "public"), "public", "private")) %>%
select(county, grade, sex_modifier, learner_toilet_ratio, public_private)
) %>%
rename(age_modifier = grade) %>%
mutate(county = case_when(county == "Kish" ~ "Kisii",
TRUE ~ county))
public_enrolment <- enrolment %>%
filter(public_private == "public" & !str_detect(grade, "total")) %>%
group_by(county, sex_modifier, age_modifier) %>%
summarise(enrolment = sum(enrolment))
learner_toilet_ratio_recalculated <- rbind(
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
mutate(toilets = (enrolment / learner_toilet_ratio)) %>%
group_by(county, age_modifier) %>%
summarise(enrolment = sum(enrolment),
toilets = sum(toilets)) %>%
mutate(learner_toilet_ratio = enrolment / toilets,
sex_modifier = "total"),
learner_toilet_ratio %>%
mutate(county = str_trim(county)) %>%
filter(public_private == "public") %>%
left_join(public_enrolment,
by = c("county" = "county",
"sex_modifier" = "sex_modifier",
"age_modifier" = "age_modifier")) %>%
mutate(toilets = (enrolment / learner_toilet_ratio)) %>%
select(county, age_modifier, sex_modifier, enrolment, toilets, learner_toilet_ratio))
counties %>% glimpse()
learner_toilet_ratio_recalculated %>% glimpse()
counties %>%
rbind(learner_toilet_ratio_recalculated %>%
mutate(indicator = "learner_toilet_ratio") %>%
select(indicator, county, age_modifier, sex_modifier, value = learner_toilet_ratio))
counties %>%
rbind(learner_toilet_ratio_recalculated %>%
mutate(indicator = "learner_toilet_ratio") %>%
select(indicator, county, age_modifier, sex_modifier, value = learner_toilet_ratio)) %>%
count(indicator)
county_list <- counties %>% distinct(county) %>% pull()
county_list
asal_county_list <- counties %>% distinct(county) %>% pull()
counties %>%
rbind(learner_toilet_ratio_recalculated %>%
filter(county %in% c(asal_county_list)) %>%
mutate(indicator = "learner_toilet_ratio") %>%
select(indicator, county, age_modifier, sex_modifier, value = learner_toilet_ratio)) %>%
count(indicator)
learner_toilet_ratio_recalculated %>% write_csv("./data/learner_toilet_ratio_recalculated.csv")
